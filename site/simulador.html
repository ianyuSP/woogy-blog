<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Sísmico | WOOGY Blog</title>

    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ------- VELOCÍMETRO -------- */
        .sim-gauge-container {
            width: 100%;
            max-width: 650px;
            margin: 0 auto 25px auto;
            text-align: center;
        }
        .gauge-wrapper {
            width: 100%;
            max-width: 650px;
            margin: 0 auto;
        }
        .gauge-svg {
            width: 100%;
            height: auto;
            display: block;
        }
        .needle {
            transition: transform 0.6s ease-in-out;
            transform-origin: 150px 150px;
        }
        .gauge-shadow {
            filter: drop-shadow(0px 0px 4px rgba(0,0,0,0.4));
        }
    </style>
</head>

<body>

<header class="header">
    <nav class="navbar">
        <span class="logo">WOOGY</span>
        <div class="menu">
            <a href="index.html">Mi Blog</a>
            <a href="hechos_historicos.html">Hechos Históricos</a>
            <a href="educ_sis.html">Educación Sísmica</a>
            <a href="material_de_apoyo.html">Material de Apoyo</a>
        </div>
    </nav>
</header>

<main class="content-wrapper">
    <section class="page-title-section">
        <h2>Simulador de Recomendaciones Sísmicas</h2>
        <p>Este simulador está enfocado en Iztapalapa, una zona donde los sismos se amplifican.</p>
    </section>

    <section class="article-section">
        <div class="sim-box" id="sim-box">

            <h3 class="sim-title">Datos del Sismo</h3>

            <form id="sim-form" class="sim-form">

                <div class="sim-field">
                    <label class="sim-label">Magnitud del sismo:</label>
                    <input
                        type="number"
                        id="magnitude"
                        class="sim-input"
                        min="1"
                        max="10"
                        step="0.1"
                        placeholder="Ej. 7.5">
                </div>

                <div class="sim-field">
                    <label class="sim-label">Planta en la que te encuentras:</label>
                    <select id="floor" class="sim-select">
                        <option value="baja">Planta baja</option>
                        <option value="media">Piso medio</option>
                        <option value="alta">Piso alto</option>
                    </select>
                </div>

                <div class="sim-field">
                    <label class="sim-label">Tipo de movimiento:</label>
                    <select id="movement" class="sim-select">
                        <option value="oscilatorio">Oscilatorio</option>
                        <option value="trepidatorio">Trepidatorio</option>
                        <option value="mixto">Mixto</option>
                    </select>
                </div>

                <button type="button" class="all-posts-btn sim-btn" id="sim-submit">
                    Generar recomendación
                </button>

            </form>

        </div>
    </section>

</main>

<footer class="main-footer">
    <p>*Derechos Reservados © 2025 UNRC*</p>
</footer>


<script>
(function () {

    const simBox = document.getElementById("sim-box");
    const originalBoxHTML = simBox.innerHTML;
    const API_URL = "https://woogy-backend-pp.onrender.com/simular";

    /* -------------------------
       ÁNGULOS EXACTOS DEL GAUGE
       ------------------------- */
    function magnitudeToAngle(m) {

        if (m < 4.0) {
            const t = (m - 1.0) / (3.9 - 1.0);
            return -90 + t * 60;
        }

        if (m < 6.0) {
            const t = (m - 4.0) / (5.9 - 4.0);
            return -30 + t * 60;
        }

        const t = (m - 6.0) / (10.0 - 6.0);
        return 30 + t * 60;
    }

    function configurarFormulario() {
        const btn = document.getElementById("sim-submit");

        btn.addEventListener("click", async () => {
            const magnitude = parseFloat(document.getElementById("magnitude").value);
            const floor = document.getElementById("floor").value;
            const movement = document.getElementById("movement").value;

            if (isNaN(magnitude)) {
                alert("Ingresa una magnitud válida.");
                return;
            }

            simBox.innerHTML = `
                <h3 class="sim-title">Generando recomendación...</h3>
                <p class="sim-helper-text">Analizando parámetros del sismo...</p>
            `;

            await new Promise(r => setTimeout(r, 400));

            const response = await fetch(API_URL, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ magnitude, floor, movement })
            });

            const data = await response.json();

            const angle = magnitudeToAngle(magnitude);

            simBox.innerHTML = `
                <h3 class="sim-title">Recomendación Sísmica</h3>
                <p class="sim-text">${data.recomendacion}</p>

                <div class="sim-gauge-container">
                    <h4 class="sim-subtitle">
                        Nivel de riesgo:
                        <span>${data.nivel.toUpperCase()}</span>
                        <span>(${data.intervalo})</span>
                    </h4>

                    <div class="gauge-wrapper gauge-shadow">

                        <svg viewBox="0 0 300 170" class="gauge-svg">

                            <path d="M20 150 A130 130 0 0 1 280 150"
                                stroke="#222" stroke-width="22" fill="none" stroke-linecap="round"/>

                            <path d="M20 150 A130 130 0 0 1 130 40"
                                stroke="#2ecc71" stroke-width="20" fill="none" stroke-linecap="round"/>

                            <path d="M130 40 A130 130 0 0 1 210 40"
                                stroke="#f1c40f" stroke-width="20" fill="none" stroke-linecap="round"/>

                            <path d="M210 40 A130 130 0 0 1 280 150"
                                stroke="#e74c3c" stroke-width="20" fill="none" stroke-linecap="round"/>

                            <line id="gauge-needle"
                                x1="150" y1="150" x2="150" y2="45"
                                stroke="black"
                                class="needle"
                                stroke-width="6" stroke-linecap="round"
                                transform="rotate(-90,150,150)" />

                            <circle cx="150" cy="150" r="9" fill="black"/>
                        </svg>

                        <div class="gauge-value">Magnitud: ${magnitude.toFixed(1)}</div>
                    </div>
                </div>

                <button class="all-posts-btn sim-btn-restart">Nueva simulación</button>
            `;

            /* --------------------------
               ACTIVAR ANIMACIÓN DE AGUJA
               -------------------------- */
            setTimeout(() => {
                const needle = document.getElementById("gauge-needle");
                needle.setAttribute("transform", `rotate(${angle},150,150)`);
            }, 80);

            simBox.querySelector(".sim-btn-restart").addEventListener("click", () => {
                simBox.innerHTML = originalBoxHTML;
                configurarFormulario();
            });
        });
    }

    configurarFormulario();

})();
</script>

</body>
</html>

