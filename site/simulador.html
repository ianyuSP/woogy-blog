<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Sísmico | WOOGY Blog</title>

    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .sim-gauge-container {
            width: 100%;
            max-width: 650px;
            margin: 0 auto 25px auto;
            text-align: center;
        }

        .gauge-wrapper {
            width: 100%;
            max-width: 650px;
            margin: 0 auto;
        }

        .gauge-svg {
            width: 100%;
            height: auto;
            display: block;
        }

        .gauge-value {
            font-size: 18px;
            margin-top: 10px;
            font-weight: bold;
        }

        .chart-container {
            width: 100%;
            max-width: 750px;
            margin: 30px auto 10px auto;
        }

        .chart-title {
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
        }

        .chart-subtitle {
            text-align: center;
            font-size: 14px;
            margin-bottom: 12px;
            color: #444;
        }

        canvas {
            width: 100% !important;
            height: auto !important;
        }

        .chart-btns {
            text-align: center;
            margin-bottom: 15px;
        }

        .chart-btns button {
            border: 1px solid #b67a5c;
            background: white;
            padding: 6px 14px;
            border-radius: 15px;
            margin: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .chart-btns button.active {
            background: #b67a5c;
            color: white;
        }

        @media (max-width: 768px) {
            .gauge-wrapper {
                max-width: 95%;
            }
            .gauge-value {
                font-size: 16px;
            }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<header class="header">
    <nav class="navbar">
        <span class="logo">WOOGY</span>
        <div class="menu">
            <a href="index.html">Mi Blog</a>
            <a href="hechos_historicos.html">Hechos Históricos</a>
            <a href="educ_sis.html">Educación Sísmica</a>
            <a href="material_de_apoyo.html">Material de Apoyo</a>
        </div>
        <div class="social-icons">
            <i class="fa-brands fa-facebook"></i>
            <i class="fa-brands fa-github"></i>
            <i class="fa-solid fa-user"></i>
        </div>
    </nav>
</header>

<main class="content-wrapper">
    <section class="page-title-section">
        <div class="title-container">
            <h2>Simulador de Recomendaciones Sísmicas</h2>
            <p>
                Este simulador está enfocado en Iztapalapa, una zona con suelos blandos donde los sismos
                se amplifican. Las recomendaciones se basan en protocolos oficiales adaptados a este contexto.
            </p>
        </div>
    </section>

    <section class="article-section">
        <div class="sim-box" id="sim-box">

            <h3 class="sim-title">Datos del Sismo</h3>

            <form id="sim-form" class="sim-form">

                <div class="sim-field">
                    <label class="sim-label">Magnitud del sismo:</label>
                    <input
                        type="number"
                        id="magnitude"
                        class="sim-input"
                        min="1"
                        max="10"
                        step="0.1"
                        placeholder="Ej. 7.5">
                </div>

                <div class="sim-field">
                    <label class="sim-label">Planta en la que te encuentras:</label>
                    <select id="floor" class="sim-select">
                        <option value="baja">Planta baja</option>
                        <option value="media">Piso medio</option>
                        <option value="alta">Piso alto</option>
                    </select>
                </div>

                <div class="sim-field">
                    <label class="sim-label">Tipo de movimiento:</label>
                    <select id="movement" class="sim-select">
                        <option value="oscilatorio">Oscilatorio</option>
                        <option value="trepidatorio">Trepidatorio</option>
                        <option value="mixto">Mixto</option>
                    </select>
                </div>

                <button type="button" class="all-posts-btn sim-btn" id="sim-submit">
                    Generar recomendación
                </button>

            </form>

        </div>
    </section>

</main>

<footer class="main-footer">
    <div class="footer-content">
        <div class="footer-section about">
            <h3>Acerca del Blog</h3>
            <p>Un espacio dedicado a la seguridad, la prevención sísmica y la resiliencia comunitaria.</p>
        </div>
        <div class="footer-section links">
            <h3>Enlaces Rápidos</h3>
            <ul>
                <li><a href="index.html">Mi Blog</a></li>
                <li><a href="documento-prototipico.pdf" target="_blank">Documento Prototípico</a></li>
                <li><a href="politica_privacidad.html">Política de Privacidad</a></li>
            </ul>
        </div>
        <div class="footer-section contact">
            <h3>Atención Ciudadana</h3>
            <p>Teléfono: 55 1519 1864</p>
            <p>Emergencias: 55 5683 2222</p>
            <p>Correo: atencion.ciudadana.sgirpc@cdmx.gob.mx</p>
        </div>
    </div>

    <div class="footer-bottom">
        <p>*Derechos Reservados © 2025 UNRC* | Parte del
            <a class="prototipico-link" href="documento-prototipico.pdf" target="_blank">Proyecto Prototípico</a></p>
    </div>
</footer>

<script>
    
(function () {
    const simBox = document.getElementById("sim-box");
    const originalBoxHTML = simBox.innerHTML;

    const API_URL = "https://woogy-backend-pp.onrender.com/simular";

    function getColorHex(colorName) {
        switch (colorName) {
            case "verde":    return "#2ecc71";
            case "amarillo": return "#e67e22";
            case "rojo":     return "#e74c3c";
            default:         return "#2ecc71";
        }
    }

    function calcularImpacto(mag) {
        if (mag < 4.0) return 1.5;
        if (mag < 6.0) return 5.0;
        if (mag < 7.5) return 7.5;
        if (mag < 8.5) return 9.0;
        return 10.0;
    }

    let chartInstance = null;

    function drawChart(category, magnitude) {
        const chartArea = document.getElementById("sim-chart");
        const labels = ["1985", "2017", "Simulación"];
        const values = {
            magnitud: [10, 8.5, magnitude],
            infraestructura: [10, 8.0, calcularImpacto(magnitude)],
            mortal: [10, 8.5, calcularImpacto(magnitude)],
            iztapalapa: [10, 8.0, calcularImpacto(magnitude)]
        };

        const dataset = values[category];

        if (chartInstance) chartInstance.destroy();

        chartInstance = new Chart(chartArea, {
            type: "bar",
            data: {
                labels,
                datasets: [{
                    data: dataset,
                    backgroundColor: ["#e74c3c", "#3498db", "#2ecc71"]
                }]
            },
            options: {
                scales: {
                    y: {
                        min: 0,
                        max: 10,
                        ticks: { stepSize: 1 }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    function configurarFormulario() {
        const btn = document.getElementById("sim-submit");
        if (!btn) return;

        btn.addEventListener("click", async () => {
            const magnitude = parseFloat(document.getElementById("magnitude").value);
            const floor = document.getElementById("floor").value;
            const movement = document.getElementById("movement").value;

            if (isNaN(magnitude)) {
                alert("Ingresa una magnitud válida entre 1.0 y 10.0.");
                return;
            }

            simBox.innerHTML = `
                <h3 class="sim-title">Generando recomendación...</h3>
                <div class="sim-loading">
                    <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                </div>
            `;

            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    magnitude,
                    floor,
                    movement
                })
            });

            const data = await response.json();

            const needleAngle = -90 + ((magnitude - 1) / 9) * 180;

            simBox.innerHTML = `
                <h3 class="sim-title">Recomendación Sísmica</h3>
                <p class="sim-text">${data.recomendacion}</p>

                <div class="sim-gauge-container">
                    <h4 class="sim-subtitle">
                        Nivel de riesgo: <span class="sim-risk-level">${data.nivel.toUpperCase()}</span>
                        <span class="sim-risk-interval">(${data.intervalo})</span>
                    </h4>

                    <div class="gauge-wrapper">
                        <svg viewBox="0 0 300 170" class="gauge-svg">

                            <!-- Fondo -->
                            <path d="M20 150 A130 130 0 0 1 280 150"
                                stroke="#222" stroke-width="20" fill="none" stroke-linecap="round"/>

                            <!-- VERDE -->
                            <path d="M20 150 A130 130 0 0 1 140 60"
                                  stroke="#2ecc71" stroke-width="18" fill="none" stroke-linecap="round"/>

                            <!-- NARANJA -->
                            <path d="M140 60 A130 130 0 0 1 205 60"
                                  stroke="#e67e22" stroke-width="18" fill="none" stroke-linecap="round"/>

                            <!-- ROJO -->
                            <path d="M205 60 A130 130 0 0 1 280 150"
                                  stroke="#e74c3c" stroke-width="18" fill="none" stroke-linecap="round"/>

                            <!-- Aguja -->
                            <line x1="150" y1="150" x2="150" y2="45"
                                  stroke="#444" stroke-width="6"
                                  transform="rotate(${needleAngle},150,150)"/>

                            <circle cx="150" cy="150" r="10" fill="#333"/>
                        </svg>

                        <div class="gauge-value">
                            Magnitud: ${magnitude.toFixed(1)}
                        </div>
                    </div>
                </div>

                <!-- GRÁFICA -->
                <div class="chart-title">Gráfica comparativa de sismos</div>
                <div class="chart-subtitle">Índice global de impacto (0 = impacto casi nulo, 10 = impacto extremo).</div>

                <div class="chart-btns">
                    <button class="chart-tab active" data-type="magnitud">Comparación de magnitud</button>
                    <button class="chart-tab" data-type="infraestructura">Daño a infraestructura</button>
                    <button class="chart-tab" data-type="mortal">Riesgo mortal</button>
                    <button class="chart-tab" data-type="iztapalapa">Daños en Iztapalapa</button>
                </div>

                <div class="chart-container">
                    <canvas id="sim-chart"></canvas>
                </div>

                <button type="button" class="all-posts-btn sim-btn-restart">
                    Nueva simulación
                </button>
            `;

            drawChart("magnitud", magnitude);

            document.querySelectorAll(".chart-tab").forEach(btn => {
                btn.addEventListener("click", () => {
                    document.querySelectorAll(".chart-tab").forEach(b => b.classList.remove("active"));
                    btn.classList.add("active");
                    drawChart(btn.dataset.type, magnitude);
                });
            });

            document.querySelector(".sim-btn-restart").addEventListener("click", () => {
                simBox.innerHTML = originalBoxHTML;
                configurarFormulario();
            });

        });
    }

    configurarFormulario();
})();
</script>

</body>
</html>

