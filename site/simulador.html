<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Sísmico | WOOGY Blog</title>

    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="/static/img/woogy_icon.png">

    <!-- Estilos para gráfica -->
    <style>

        .sim-chart-container {
            width: 100%;
            max-width: 650px;
            margin: 10px auto 20px auto;
            text-align: center;
        }
        .sim-chart-svg {
            width: 100%;
            height: auto;
            display: block;
            margin: 15px auto 10px auto;
        }
        .sim-chart-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 8px;
        }
        .sim-chart-tab {
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid #c07a55;
            background: #ffffff;
            color: #7a4b30;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .sim-chart-tab.active {
            background: #c07a55;
            color: #ffffff;
        }
        .sim-chart-legend {
            font-size: 0.85rem;
            margin-top: 6px;
        }
        .sim-chart-legend span {
            margin: 0 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .sim-chart-legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        .sim-chart-scale {
            font-size: 0.8rem;
            margin-top: 4px;
            color: #7a6a5c;
        }

        @media (max-width: 768px) {
            .sim-chart-container {
                max-width: 95%;
            }
        }
    </style>
</head>

<body>
<header class="header">
    <nav class="navbar">
        <span class="logo">WOOGY</span>
        <div class="menu">
            <a href="index.html">Mi Blog</a>
            <a href="hechos_historicos.html">Hechos Históricos</a>
            <a href="educ_sis.html">Educación Sísmica</a>
            <a href="material_de_apoyo.html">Material de Apoyo</a>
        </div>
             <div class="social-icons">
    <a href="https://www.facebook.com/share/1782TJnQBv/" target="_blank">
        <i class="fa-brands fa-facebook"></i>
    </a>
    <a href="https://github.com/ianyuSP?tab=repositories" target="_blank">
        <i class="fa-brands fa-github"></i>
    </a>
</div>
    </nav>
</header>
<main class="content-wrapper">
    <section class="page-title-section">
        <div class="title-container">
            <h2>Simulador de Recomendaciones Sísmicas</h2>
            <p>
                Este simulador está enfocado en Iztapalapa, una zona con suelos blandos donde los sismos
                se amplifican. Las recomendaciones se basan en protocolos oficiales adaptados a este contexto.
            </p>
        </div>
    </section>

    <section class="article-section">
        <div class="sim-box" id="sim-box">

            <h3 class="sim-title">Datos del Sismo</h3>

            <form id="sim-form" class="sim-form">

                <div class="sim-field">
                    <label class="sim-label">Magnitud del sismo:</label>
                    <input type="number" id="magnitude" class="sim-input" min="1" max="10" step="0.1" placeholder="Ej. 7.5">
                </div>

                <div class="sim-field">
                    <label class="sim-label">Planta en la que te encuentras:</label>
                    <select id="floor" class="sim-select">
                        <option value="baja">Planta baja</option>
                        <option value="media">Piso medio</option>
                        <option value="alta">Piso alto</option>
                    </select>
                </div>

                <div class="sim-field">
                    <label class="sim-label">Tipo de movimiento:</label>
                    <select id="movement" class="sim-select">
                        <option value="oscilatorio">Oscilatorio</option>
                        <option value="trepidatorio">Trepidatorio</option>
                        <option value="mixto">Mixto</option>
                    </select>
                </div>

                <button type="button" class="all-posts-btn sim-btn" id="sim-submit">
                    Generar recomendación
                </button>

            </form>

        </div>
    </section>
</main>

<footer class="main-footer">
    <div class="footer-content">
        <div class="footer-section about">
            <h3>Acerca del Blog</h3>
            <p>Un espacio dedicado a la seguridad, la prevención sísmica y la resiliencia comunitaria.</p>
        </div>
        <div class="footer-section links">
            <h3>Enlaces Rápidos</h3>
            <ul>
                <li><a href="index.html">Mi Blog</a></li>
                <li><a href="/static/img/Doc_Proyecto_PP.pdf" target="_blank">Documento Prototípico</a></li>
                <li><a href="politica_privacidad.html">Política de Privacidad</a></li>
            </ul>
        </div>
        <div class="footer-section contact">
            <h3>Atención Ciudadana</h3>
            <p>Teléfono: 55 1519 1864</p>
            <p>Emergencias: 55 5683 2222</p>
            <p>Correo: atencion.ciudadana.sgirpc@cdmx.gob.mx</p>
        </div>
    </div>

    <div class="footer-bottom">
            <p>*Derechos Reservados © 2025 UNRC* | Este contenido es parte de nuestro <a href="https://drive.google.com/drive/folders/1x7vTlzmbvezsbKLVHr1hV4QyxEgycg_j?usp=sharing" target="_blank" class="prototipico-link">Proyecto Prototípico</a></p>
        </div>
</footer>

<script>
(function () {

    const simBox = document.getElementById("sim-box");
    const originalBoxHTML = simBox.innerHTML;

    const API_URL = "https://woogy-backend-pp.onrender.com/simular";

    function getColorHex(colorName) {
        switch (colorName) {
            case "verde": return "#2ecc71";
            case "amarillo": return "#f1c40f";
            case "naranja": return "#e67e22";
            case "rojo": return "#e74c3c";
            default: return "#2ecc71";
        }
    }

    function configurarFormulario() {
        const btn = document.getElementById("sim-submit");
        if (!btn) return;

        btn.addEventListener("click", async () => {

            const magnitude = parseFloat(document.getElementById("magnitude").value);
            const floor = document.getElementById("floor").value;
            const movement = document.getElementById("movement").value;

            if (isNaN(magnitude)) {
                alert("Ingresa una magnitud válida entre 1.0 y 10.0.");
                return;
            }

            simBox.innerHTML = `
                <h3 class="sim-title">Generando recomendación...</h3>
                <div class="sim-loading">
                    <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                </div>
                <p class="sim-helper-text">
                    Analizando la magnitud, la planta y el tipo de movimiento según Iztapalapa.
                </p>
            `;

            try {
                await new Promise(resolve => setTimeout(resolve, 500));

                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ magnitude, floor, movement })
                });

                const data = await response.json().catch(() => ({}));

                if (!response.ok) {
                    simBox.innerHTML = `
                        <h3 class="sim-title">Ocurrió un problema</h3>
                        <p class="sim-text">${data.error || "No fue posible obtener la recomendación."}</p>
                        <button type="button" class="all-posts-btn sim-btn-restart">
                            Volver al simulador
                        </button>
                    `;
                    simBox.querySelector(".sim-btn-restart").addEventListener("click", () => {
                        simBox.innerHTML = originalBoxHTML;
                        configurarFormulario();
                    });
                    return;
                }

                const recommendation = data.recomendacion;
                const nivel = data.nivel;
                simBox.innerHTML = `
                    <h3 class="sim-title">Recomendación Sísmica</h3>
                    <p class="sim-text">${recommendation}</p>

                    <div class="sim-chart-container">
                        <h4 class="sim-subtitle">Gráfica comparativa de sismos</h4>
                        <p class="sim-helper-text" id="sim-chart-desc">
                            Índice global de impacto (0 = impacto casi nulo, 10 = impacto extremo).
                        </p>

                        <div class="sim-chart-tabs">
                            <button class="sim-chart-tab active" data-metric="magnitud">Comparación de magnitud</button>
                            <button class="sim-chart-tab" data-metric="infraestructura">Daño a infraestructura</button>
                            <button class="sim-chart-tab" data-metric="mortal">Riesgo mortal</button>
                            <button class="sim-chart-tab" data-metric="iztapalapa">Daños en Iztapalapa</button>
                        </div>

                        <svg id="sim-chart" viewBox="0 0 360 260" class="sim-chart-svg"></svg>

                        <div class="sim-chart-legend" id="sim-chart-legend">
                            <span><span class="sim-chart-legend-dot" style="background:#e74c3c;"></span>1985 · Sismo M8.1</span>
                            <span><span class="sim-chart-legend-dot" style="background:#3498db;"></span>2017 · Sismo M7.1</span>
                            <span><span class="sim-chart-legend-dot" style="background:#27ae60;"></span>Simulación · Magnitud ${magnitude.toFixed(1)}</span>
                        </div>

                        <p class="sim-chart-scale">
                            Escala 0–10: 0–3 = impacto bajo, 4–6 = impacto medio, 7–8 = impacto alto, 9–10 = impacto extremo.
                        </p>
                    </div>

                    <button type="button" class="all-posts-btn sim-btn-restart">
                        Nueva simulación
                    </button>
                `;

                /* ===== CONFIGURAR GRÁFICA ===== */
                const metrics = {
                    magnitud: { descripcion: "Comparación de magnitud (1 = muy baja, 10 = extremadamente alta).", v1985: 8.1, v2017: 7.1, vsim: Math.max(1, Math.min(10, magnitude)) },
                    infraestructura: { descripcion: "Daño estimado a infraestructura (0 = sin daño, 10 = daño extremo).", v1985: 9.5, v2017: 8.0, vsim: Math.max(0, Math.min(10, magnitude * 1.2 - 2)) },
                    mortal: { descripcion: "Riesgo mortal relativo (0 = casi nulo, 10 = muy alto).", v1985: 10.0, v2017: 8.5, vsim: Math.max(0, Math.min(10, magnitude * 1.1 - 1.5)) },
                    iztapalapa: { descripcion: "Impacto estimado en Iztapalapa (0 = muy bajo, 10 = muy alto).", v1985: 8.5, v2017: 7.5, vsim: Math.max(0, Math.min(10, magnitude * 1.15 - 2)) }
                };

                const chartSvg = document.getElementById("sim-chart");
                const chartDesc = document.getElementById("sim-chart-desc");
                const legendDiv = document.getElementById("sim-chart-legend");

                function renderChart(metricKey) {

                    const m = metrics[metricKey];
                    chartDesc.textContent = m.descripcion;

                    const labels = ["1985", "2017", "Simulación"];
                    const values = [m.v1985, m.v2017, m.vsim];
                    const colors = ["#e74c3c", "#3498db", "#27ae60"];

                    const maxVal = 10;
                    const chartLeft = 50;
                    const chartRight = 330;
                    const chartTop = 20;
                    const chartBottom = 220;
                    const height = chartBottom - chartTop;

                    let grid = "";
                    for (let v = 0; v <= 10; v += 2) {
                        const y = chartBottom - (v / maxVal) * height;
                        grid += `
                            <line x1="${chartLeft}" y1="${y}" x2="${chartRight}" y2="${y}" stroke="#eee" stroke-width="1"/>
                            <text x="${chartLeft - 8}" y="${y + 4}" font-size="9" text-anchor="end" fill="#555">${v}</text>
                        `;
                    }

                    const barW = 50;
                    const baseX = 90;
                    const gap = 90;
                    let bars = "";
                    let texts = "";

                    values.forEach((val, idx) => {
                        const x = baseX + idx * gap;
                        const barH = (val / maxVal) * height;
                        const y = chartBottom - barH;

                        bars += `
                            <rect x="${x - barW/2}" y="${y}" width="${barW}" height="${barH}" fill="${colors[idx]}"/>
                        `;
                        texts += `
                            <text x="${x}" y="${chartBottom + 15}" font-size="11" text-anchor="middle" fill="#555">${labels[idx]}</text>
                            <text x="${x}" y="${y - 5}" font-size="10" text-anchor="middle" fill="#333">${val.toFixed(1)}</text>
                        `;
                    });

                    chartSvg.innerHTML = `
                        <line x1="${chartLeft}" y1="${chartTop}" x2="${chartLeft}" y2="${chartBottom}" stroke="#bba89b" stroke-width="2"/>
                        <line x1="${chartLeft}" y1="${chartBottom}" x2="${chartRight}" y2="${chartBottom}" stroke="#bba89b" stroke-width="2"/>
                        ${grid}
                        ${bars}
                        ${texts}
                    `;

                    const simText =
                        metricKey === "magnitud"
                            ? `Simulación · Magnitud ${magnitude.toFixed(1)}`
                            : `Simulación · índice ${m.vsim.toFixed(1)}`;

                    legendDiv.innerHTML = `
                        <span><span class="sim-chart-legend-dot" style="background:#e74c3c;"></span>1985 · Sismo M8.1</span>
                        <span><span class="sim-chart-legend-dot" style="background:#3498db;"></span>2017 · Sismo M7.1</span>
                        <span><span class="sim-chart-legend-dot" style="background:#27ae60;"></span>${simText}</span>
                    `;
                }

                simBox.querySelectorAll(".sim-chart-tab").forEach(btn => {
                    btn.addEventListener("click", () => {
                        simBox.querySelectorAll(".sim-chart-tab").forEach(t => t.classList.remove("active"));
                        btn.classList.add("active");
                        renderChart(btn.dataset.metric);
                    });
                });

                renderChart("magnitud");

                simBox.querySelector(".sim-btn-restart").addEventListener("click", () => {
                    simBox.innerHTML = originalBoxHTML;
                    configurarFormulario();
                });

            } catch (err) {
                console.error(err);
                simBox.innerHTML = `
                    <h3 class="sim-title">Ocurrió un problema</h3>
                    <p class="sim-text">No fue posible obtener la recomendación.</p>
                    <button type="button" class="all-posts-btn sim-btn-restart">
                        Volver al simulador
                    </button>
                `;
                simBox.querySelector(".sim-btn-restart").addEventListener("click", () => {
                    simBox.innerHTML = originalBoxHTML;
                    configurarFormulario();
                });
            }
        });
    }

    configurarFormulario();

})();
</script>

</body>
</html>
