<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Sísmico | WOOGY Blog</title>

    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header class="header">
        <nav class="navbar">
            <span class="logo">WOOGY</span>
            <div class="menu">
                <a href="home.html">Mi Blog</a>
                <a href="hechos_historicos.html">Hechos Históricos</a>
                <a href="educ_sis.html">Educación Sísmica</a>
                <a href="material_de_apoyo.html">Material de Apoyo</a>
            </div>
            <div class="social-icons">
                <i class="fa-brands fa-facebook"></i>
                <i class="fa-brands fa-github"></i>
                <i class="fa-solid fa-user"></i>
            </div>
        </nav>
    </header>

    <main class="content-wrapper">
        <section class="page-title-section">
            <div class="title-container">
                <h2>Simulador de Recomendaciones Sísmicas</h2>
                <p>
                    Este simulador está enfocado en Iztapalapa, una zona con suelos blandos donde los sismos
                    se amplifican. Las recomendaciones se basan en protocolos oficiales adaptados a este contexto.
                </p>
            </div>
        </section>
        <section class="article-section">
            <div class="sim-box" id="sim-box">

                <h3 class="sim-title">Datos del Sismo</h3>

                <form id="sim-form" class="sim-form">

                    <div class="sim-field">
                        <label class="sim-label">Magnitud del sismo:</label>
                        <input
                            type="number"
                            id="magnitude"
                            class="sim-input"
                            min="1"
                            max="10"
                            step="0.1"
                            placeholder="Ej. 7.5">
                    </div>

                    <div class="sim-field">
                        <label class="sim-label">Planta en la que te encuentras:</label>
                        <select id="floor" class="sim-select">
                            <option value="baja">Planta baja</option>
                            <option value="media">Piso medio</option>
                            <option value="alta">Piso alto</option>
                        </select>
                    </div>

                    <div class="sim-field">
                        <label class="sim-label">Tipo de movimiento:</label>
                        <select id="movement" class="sim-select">
                            <option value="oscilatorio">Oscilatorio</option>
                            <option value="trepidatorio">Trepidatorio</option>
                            <option value="mixto">Mixto</option>
                        </select>
                    </div>

                    <button type="button" class="all-posts-btn sim-btn" id="sim-submit">
                        Generar recomendación
                    </button>

                </form>

            </div>
        </section>

    </main>
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section about">
                <h3>Acerca del Blog</h3>
                <p>Un espacio dedicado a la seguridad, la prevención sísmica y la resiliencia comunitaria.</p>
            </div>
            <div class="footer-section links">
                <h3>Enlaces Rápidos</h3>
                <ul>
                    <li><a href="home.html">Mi Blog</a></li>
                    <li><a href="documento-prototipico.pdf" target="_blank">Documento Prototípico</a></li>
                    <li><a href="politica_privacidad.html">Política de Privacidad</a></li>
                </ul>
            </div>
            <div class="footer-section contact">
                <h3>Atención Ciudadana</h3>
                <p>Teléfono: 55 1519 1864</p>
                <p>Emergencias: 55 5683 2222</p>
                <p>Correo: atencion.ciudadana.sgirpc@cdmx.gob.mx</p>
            </div>
        </div>

        <div class="footer-bottom">
            <p>*Derechos Reservados © 2025 UNRC* | Parte del
                <a class="prototipico-link" href="documento-prototipico.pdf" target="_blank">Proyecto Prototípico</a></p>
        </div>
    </footer>
        <script>
    (function () {
        const simBox = document.getElementById("sim-box");
        const originalBoxHTML = simBox.innerHTML;

        const API_URL = "https://woogy-backend-pp.onrender.com/simular";

        function getColorHex(colorName) {
            switch (colorName) {
                case "verde":    return "#3b7a3a";
                case "amarillo": return "#d4a017";
                case "naranja":  return "#c96b2c";
                case "rojo":     return "#b02a2a";
                default:         return "#3b7a3a";
            }
        }

        function configurarFormulario() {
            const btn = document.getElementById("sim-submit");
            if (!btn) return;

            btn.addEventListener("click", async () => {
                const magInput = document.getElementById("magnitude");
                const floorSelect = document.getElementById("floor");
                const movementSelect = document.getElementById("movement");

                const magnitude = parseFloat(magInput.value);
                const floor = floorSelect.value;
                const movement = movementSelect.value;

                if (isNaN(magnitude)) {
                    alert("Ingresa una magnitud válida entre 1.0 y 10.0.");
                    return;
                }

                simBox.innerHTML = `
                    <h3 class="sim-title">Generando recomendación...</h3>
                    <div class="sim-loading">
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>
                    <p class="sim-helper-text">
                        Analizando la magnitud, la planta y el tipo de movimiento según el contexto de Iztapalapa.
                    </p>
                `;

                try {
                    await new Promise(resolve => setTimeout(resolve, 500));

                    const response = await fetch(API_URL, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            magnitude: magnitude,
                            floor: floor,
                            movement: movement
                        })
                    });

                    const data = await response.json().catch(() => ({}));

                    if (!response.ok) {
                        const mensaje = data.error || "No fue posible obtener la recomendación. Intenta nuevamente.";
                        simBox.innerHTML = `
                            <h3 class="sim-title">Ocurrió un problema</h3>
                            <p class="sim-text">
                                ${mensaje}
                            </p>
                            <button type="button" class="all-posts-btn sim-btn-restart">
                                Volver al simulador
                            </button>
                        `;
                        const restartBtn = simBox.querySelector(".sim-btn-restart");
                        restartBtn.addEventListener("click", () => {
                            simBox.innerHTML = originalBoxHTML;
                            configurarFormulario();
                        });
                        return;
                    }

                    const recommendation = data.recomendacion || "No se pudo generar la recomendación.";
                    const nivel = data.nivel || "desconocido";
                    const color = data.color || "verde";
                    const intervalo = data.intervalo || "";
                    const yPos = typeof data.y_pos === "number" ? data.y_pos : 0.0;  // 0–1
                    const mapaArchivo = data.mapa || "mapa_verde.png";

                    // Escala de la flecha (1–10) en el eje Y
                    // eje Y: bottomY = magnitud 1, topY = magnitud 10
                    const axisX = 40;
                    const bottomY = 130;
                    const topY = 20;

                    const endX = 280;
                    const startX = axisX;
                    const startY = bottomY;

                    // yPos 0 -> mag 1 (abajo), yPos 1 -> mag 10 (arriba)
                    const arrowY = bottomY - yPos * (bottomY - topY);
                    const midX = (startX + endX) / 2;
                    const midY = topY;

                    const strokeColor = getColorHex(color);

                    simBox.innerHTML = `
                        <h3 class="sim-title">Recomendación Sísmica</h3>
                        <p class="sim-text">
                            ${recommendation}
                        </p>

<div class="sim-speedometer-block">
    <h4 class="sim-subtitle">
        Nivel de riesgo: <span class="sim-risk-level">${nivel.toUpperCase()}</span>
        <span class="sim-risk-interval">(${intervalo})</span>
    </h4>

    <div class="speedometer-wrapper">
        <svg viewBox="0 0 300 170" class="speedometer-svg">
            <!-- Dial background -->
            <defs>
                <linearGradient id="speedometerGradient" x1="0%" y1="100%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#3b7a3a"/>
                    <stop offset="40%" stop-color="#d4a017"/>
                    <stop offset="70%" stop-color="#c96b2c"/>
                    <stop offset="100%" stop-color="#b02a2a"/>
                </linearGradient>
            </defs>

            <!-- Semi circle -->
            <path d="M20 150 A130 130 0 0 1 280 150"
                  stroke="url(#speedometerGradient)"
                  stroke-width="28"
                  fill="none" />

            <!-- Tick marks -->
            ${[1,2,3,4,5,6,7,8,9,10].map((m, idx) => {
                const angle = Math.PI * (1 - idx / 9);
                const x1 = 150 + Math.cos(angle) * 95;
                const y1 = 150 - Math.sin(angle) * 95;
                const x2 = 150 + Math.cos(angle) * 120;
                const y2 = 150 - Math.sin(angle) * 120;
                return `
                    <line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}"
                          stroke="#222" stroke-width="3" />
                `;
            }).join("")}

            <!-- Needle -->
            <line id="needle"
                  x1="150" y1="150"
                  x2="150" y2="40"
                  stroke="${strokeColor}"
                  stroke-width="6"
                  stroke-linecap="round"
                  transform="rotate(${(yPos * 180) - 180},150,150)"
                  class="needle-anim"/>

            <!-- Center circle -->
            <circle cx="150" cy="150" r="10" fill="#222"/>

            <!-- Magnitude text -->
            <text x="150" y="115" text-anchor="middle"
                  font-size="28" font-weight="bold" fill="#222">
                ${magnitud.toFixed(1)}
            </text>
        </svg>
    </div>
</div>
                            <div class="sim-risk-block">
                                <h4 class="sim-subtitle">Mapa de Iztapalapa según el nivel de riesgo</h4>
                                <div class="sim-map-wrapper">
                                    <img src="../static/img/${mapaArchivo}"
                                         alt="Mapa de Iztapalapa con nivel de riesgo ${nivel}"
                                         class="sim-risk-map">
                                </div>
                            </div>
                        </div>

                        <button type="button" class="all-posts-btn sim-btn-restart">
                            Nueva simulación
                        </button>
                    `;

                    const restartBtn = simBox.querySelector(".sim-btn-restart");
                    restartBtn.addEventListener("click", () => {
                        simBox.innerHTML = originalBoxHTML;
                        configurarFormulario();
                    });

                } catch (err) {
                    console.error(err);
                    simBox.innerHTML = `
                        <h3 class="sim-title">Ocurrió un problema</h3>
                        <p class="sim-text">
                            No fue posible obtener la recomendación. Intenta nuevamente.
                        </p>
                        <button type="button" class="all-posts-btn sim-btn-restart">
                            Volver al simulador
                        </button>
                    `;
                    const restartBtn = simBox.querySelector(".sim-btn-restart");
                    restartBtn.addEventListener("click", () => {
                        simBox.innerHTML = originalBoxHTML;
                        configurarFormulario();
                    });
                }
            });
        }

        configurarFormulario();
    })();
    </script>


</body>
</html>
