<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Sísmico | WOOGY Blog</title>

    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ===== GRÁFICA ===== */
        .sim-chart-container {
            width: 100%;
            max-width: 650px;
            margin: 10px auto 20px auto;
            text-align: center;
        }
        .sim-chart-svg {
            width: 100%;
            height: auto;
            display: block;
            margin: 15px auto 10px auto;
        }
        .sim-chart-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 8px;
        }
        .sim-chart-tab {
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid #c07a55;
            background: #ffffff;
            color: #7a4b30;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .sim-chart-tab.active {
            background: #c07a55;
            color: #ffffff;
        }
        .sim-chart-legend {
            font-size: 0.85rem;
            margin-top: 6px;
        }
        .sim-chart-legend span {
            margin: 0 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .sim-chart-legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        .sim-chart-scale {
            font-size: 0.8rem;
            margin-top: 4px;
            color: #7a6a5c;
        }
    </style>
</head>

<body>
<header class="header">
    <nav class="navbar">
        <span class="logo">WOOGY</span>
        <div class="menu">
            <a href="index.html">Mi Blog</a>
            <a href="hechos_historicos.html">Hechos Históricos</a>
            <a href="educ_sis.html">Educación Sísmica</a>
            <a href="material_de_apoyo.html">Material de Apoyo</a>
        </div>
    </nav>
</header>

<main class="content-wrapper">

    <section class="page-title-section">
        <h2>Simulador de Recomendaciones Sísmicas</h2>
        <p>Este simulador está enfocado en Iztapalapa, una zona donde los sismos se amplifican.</p>
    </section>

    <section class="article-section">
        <div class="sim-box" id="sim-box">

            <h3 class="sim-title">Datos del Sismo</h3>

            <form id="sim-form" class="sim-form">

                <div class="sim-field">
                    <label class="sim-label">Magnitud del sismo:</label>
                    <input type="number" id="magnitude" class="sim-input" min="1" max="10" step="0.1" placeholder="Ej. 7.5">
                </div>

                <div class="sim-field">
                    <label class="sim-label">Planta en la que te encuentras:</label>
                    <select id="floor" class="sim-select">
                        <option value="baja">Planta baja</option>
                        <option value="media">Piso medio</option>
                        <option value="alta">Piso alto</option>
                    </select>
                </div>

                <div class="sim-field">
                    <label class="sim-label">Tipo de movimiento:</label>
                    <select id="movement" class="sim-select">
                        <option value="oscilatorio">Oscilatorio</option>
                        <option value="trepidatorio">Trepidatorio</option>
                        <option value="mixto">Mixto</option>
                    </select>
                </div>

                <button type="button" class="all-posts-btn sim-btn" id="sim-submit">Generar recomendación</button>

            </form>

        </div>
    </section>

</main>

<footer class="main-footer">
    <p>*Derechos Reservados © 2025 UNRC*</p>
</footer>

<script>
(function () {

    const simBox = document.getElementById("sim-box");
    const originalHTML = simBox.innerHTML;
    const API_URL = "https://woogy-backend-pp.onrender.com/simular";

    function configurarFormulario() {

        document.getElementById("sim-submit").addEventListener("click", async () => {

            const magnitude = parseFloat(document.getElementById("magnitude").value);
            const floor = document.getElementById("floor").value;
            const movement = document.getElementById("movement").value;

            if (isNaN(magnitude)) {
                alert("Ingresa una magnitud válida.");
                return;
            }

            simBox.innerHTML = `
                <h3 class="sim-title">Generando recomendación...</h3>
                <p>Analizando parámetros del sismo...</p>
            `;

            await new Promise(r => setTimeout(r, 400));

            const response = await fetch(API_URL, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ magnitude, floor, movement })
            });

            const data = await response.json();

            /* ----------- MOSTRAR RECOMENDACIÓN Y GRÁFICA ----------- */

            simBox.innerHTML = `
                <h3 class="sim-title">Recomendación Sísmica</h3>
                <p class="sim-text">${data.recomendacion}</p>

                <!-- GRÁFICA -->
                <div class="sim-chart-container">
                    <h4 class="sim-subtitle">Gráfica comparativa de sismos</h4>

                    <p id="sim-chart-desc">Índice global de impacto.</p>

                    <div class="sim-chart-tabs">
                        <button class="sim-chart-tab active" data-metric="magnitud">Magnitud</button>
                        <button class="sim-chart-tab" data-metric="infraestructura">Infraestructura</button>
                        <button class="sim-chart-tab" data-metric="mortal">Riesgo mortal</button>
                        <button class="sim-chart-tab" data-metric="iztapalapa">Iztapalapa</button>
                    </div>

                    <svg id="sim-chart" viewBox="0 0 360 260" class="sim-chart-svg"></svg>

                    <div class="sim-chart-legend" id="sim-chart-legend">
                        <span><span class="sim-chart-legend-dot" style="background:#e74c3c;"></span>1985</span>
                        <span><span class="sim-chart-legend-dot" style="background:#3498db;"></span>2017</span>
                        <span><span class="sim-chart-legend-dot" style="background:#27ae60;"></span>Simulación</span>
                    </div>

                    <p class="sim-chart-scale">Escala 0–10.</p>
                </div>

                <button class="all-posts-btn sim-btn-restart">Nueva simulación</button>
            `;

            /* ------------ CONFIGURAR GRÁFICA ------------ */

            const metrics = {
                magnitud: {
                    descripcion: "Comparación de magnitud.",
                    v1985: 8.1,
                    v2017: 7.1,
                    vsim: magnitude
                },
                infraestructura: {
                    descripcion: "Daño a infraestructura.",
                    v1985: 9.5,
                    v2017: 8.0,
                    vsim: Math.max(0, Math.min(10, magnitude * 1.2 - 2))
                },
                mortal: {
                    descripcion: "Riesgo mortal relativo.",
                    v1985: 10.0,
                    v2017: 8.5,
                    vsim: Math.max(0, Math.min(10, magnitude * 1.1 - 1.5))
                },
                iztapalapa: {
                    descripcion: "Impacto estimado en Iztapalapa.",
                    v1985: 8.5,
                    v2017: 7.5,
                    vsim: Math.max(0, Math.min(10, magnitude * 1.15 - 2))
                }
            };

            const chartSvg = document.getElementById("sim-chart");
            const chartDesc = document.getElementById("sim-chart-desc");
            const legend = document.getElementById("sim-chart-legend");

            function renderChart(metricKey) {

                const m = metrics[metricKey];
                chartDesc.textContent = m.descripcion;

                const labels = ["1985", "2017", "Simulación"];
                const values = [m.v1985, m.v2017, m.vsim];
                const colors = ["#e74c3c", "#3498db", "#27ae60"];

                const maxVal = 10;
                const chartLeft = 50;
                const chartRight = 330;
                const chartTop = 20;
                const chartBottom = 220;
                const height = chartBottom - chartTop;

                let grid = "";
                for (let v = 0; v <= 10; v += 2) {
                    const y = chartBottom - (v / maxVal) * height;
                    grid += `
                        <line x1="${chartLeft}" y1="${y}" x2="${chartRight}" y2="${y}"
                              stroke="#eee" stroke-width="1" />
                        <text x="${chartLeft - 8}" y="${y + 4}" font-size="9" text-anchor="end" fill="#555">${v}</text>
                    `;
                }

                const barW = 50;
                const baseX = 90;
                const gap = 90;
                let bars = "";
                let texts = "";

                values.forEach((val, idx) => {
                    const x = baseX + idx * gap;
                    const barH = (val / maxVal) * height;
                    const y = chartBottom - barH;

                    bars += `
                        <rect x="${x - barW/2}" y="${y}" width="${barW}" height="${barH}"
                              fill="${colors[idx]}" />
                    `;
                    texts += `
                        <text x="${x}" y="${chartBottom + 15}" font-size="11" text-anchor="middle">${labels[idx]}</text>
                        <text x="${x}" y="${y - 5}" font-size="10" text-anchor="middle">${val.toFixed(1)}</text>
                    `;
                });

                chartSvg.innerHTML = `
                    <line x1="${chartLeft}" y1="${chartTop}" x2="${chartLeft}" y2="${chartBottom}" stroke="#bba89b" stroke-width="2" />
                    <line x1="${chartLeft}" y1="${chartBottom}" x2="${chartRight}" y2="${chartBottom}" stroke="#bba89b" stroke-width="2" />
                    ${grid}
                    ${bars}
                    ${texts}
                `;
            }

            renderChart("magnitud");

            /* Tabs */
            simBox.querySelectorAll(".sim-chart-tab").forEach(btn => {
                btn.addEventListener("click", () => {
                    simBox.querySelectorAll(".sim-chart-tab").forEach(t => t.classList.remove("active"));
                    btn.classList.add("active");
                    renderChart(btn.dataset.metric);
                });
            });

            simBox.querySelector(".sim-btn-restart").addEventListener("click", () => {
                simBox.innerHTML = originalHTML;
                configurarFormulario();
            });

        });
    }

    configurarFormulario();

})();
</script>

</body>
</html>
